<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>acg - Blog</title>
		<link rel="stylesheet" type="text/css" href="../../assets/css/styles.css">
		<link rel="icon" href="../../assets/images/favicon.png">
	</head>
	<body>
		<h1 class="title"><a href="../index.shtml">acomputerguy</a></h1>
		
		<nav>
			<ul>
				<li><a href="../contact.shtml">contact</a></li>
				<li><a href="../aboutMe.shtml">about me</a></li>
				<li><a href="../blog.shtml">blog</a></li>
			</ul>
		</nav>
		
		<h2>Automating Classwork</h2>
		
		<section>
			<aside>
				<ul>
					<li><a href="firstDay.shtml">Day 1 at Work: Efficiency</a></li>
					<li><a href="funWithNmap.shtml">Perpetual Scanning</a></li>
					<li class="currentPost"><a href="automateClass.shtml">Automating a Competition</a></li>
				</ul>
			</aside>
			
			<p class="subtopic">Infrastructure in place<p>
			<p>discuss infrastr details here</p>
			
			<p class="subtopic">Automating in-class competitions</p>
			
			<p>This attack/defend class is structured to be divided into 3 rotating teams: 
			<font color="blue">blue</font> team, <font color="red">red</font> team, and <font color="e6e6e6">white</font> team.
			White <font color="e6e6e6">deploys</font>, red <font color="red">attacks</font>, and blue <font color="blue">defends</font>
			their respective virtual machines. 
			There is a fourth role which is usually 1 person, which is the back-end/DevOps guy. With many iterations of this class,
			this is the first time someone wrote the code because normally they're too swamped with other aspects of their role.
			I figure I'd try something new, so I signed up for the back-end role.</p>
			
			<p>So my partner and I don't have to <s>show up to class anymore</s> invest more time in other projects! Do more with less, right?</p>
			
			<p>I wrote about a dozen scripts for this class but I'll be discussing the one I'm proudest of - the script I wrote
			to automate a competition so my partner and I didn't have to repeat process we go through during a competition in class.
			With issues that came up, my code had to adapt to the new changes and use different approaches.
			In the script's simplest form, it accomplishes the following:</p>
			
			<ul>
				<li>Request snapshot information</li>
				<li>Grant access to students</li>
				<li>Turn on virtual boxes</li>
				<li>Wait</li>
				<li>Message users before time limit</li>
				<li>Disconnect students</li>
				<li>Take away permissions</li>
				<li>Suspend virtual boxes</li>
				<li>Take snapshots</li>
			</ul>
			
			<p>I'll be discussing the process in greater detail below</p>
			
			<p class="subtopic">Snapshot Prompts & Access Granted</p>
			<p>Prompt user for snapshot names and descriptions. This is so when the script runs in the background, I can leave when
			the competition is over and have the process handle the rest. Beats having to wait 30 minutes to 1 hour after class
			to type some more commands!</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp1_snapshotDescriptions.png" alt="comp1_snapshotDescriptions.png">
			</figure>
			
			<p>Grant access to all Red & Blue Team members via Console Only roles. This is done by adjusting privileges. In PowerCLI,
			permissions consist of roles, and roles consist of privileges so it goes Permissions->Roles->Privileges.</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp2_privileges.png" alt="comp2_privileges.png">
			</figure>
			
			<p>I figured printing out the virtual machines with their respective team colors would be neater than a constant black/white terminal.</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp3_vmsInCompetition.png" alt="comp3_vmsInCompetition.png">
			</figure>
			
			<p class="subtopic">Starting Virtual Boxes Approach</p>
			<p>Turn on blue and red team virtual machines that aren't already on consectutuvely.</p>
			<p>Sometimes people will be impatient and start the boxes anyways, so I have to take that into account in my code.
			Privilege was intended to be granted prior to students logging on.</p>
			<p>Another issue was timing - white team and I usually come in early to make sure the infrastructure is ready
			for the competition. We would have to come in even earlier because the server could not handle processing 
			so many requests for so many virtual machines at once.</p>
			<p>If the code sent multiple requests to the server about turning on the virtual machines, the queue
			would take <i>significantly longer</i> to process, or even <i>expire</i> so the query never goes through as a result of
			taking too long. Consequently, I had to modify the code to issue each command and wait for it to 
			finish before proceeding to the next one. The same is true in the future when I suspend and snapshot the machines.</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp4_currentlyOn.png" alt="comp4_currentlyOn.png">
			</figure>
			
			<p class="subtopic">Powershell Progress Bar</p>
			<p>User-defined input will indicate waiting time until the next command in a progress bar.
			Instead of pausing the code until the end of the competition, why not make a progress bar to show 
			how much time has elapsed? Sometimes the competition would start late with white team delays or the lab's
			DNS server going down. Considering these pushbacks, I allow the user to input how much time they need,
			which depends on when the competition begins.</p>
			<p>I was so happy when I discovered the <code>Write-Progress</code> cmdlet exists, 
			I brought it upon myself to create my own loading bar! (WIP)</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp5_progressBar.png" alt="comp5_progressBar.png">
			</figure>
			
			<p class="subtopic">Broadcast Message</p>
			<p>White team always had to yell, "TEN MINUTES LEFT!" then 5 minutes later, "FIVE MINUTES LEFT!" towards the end of the class.
			I always wanted to figure out a way to get the message across by saving a few strains on their vocal chords.
			When I found out about this Broadcast Message of the Day [MoTD] feature, I was ecstatic. I had to be careful to not abuse this,
			since it sends a broadcast message to all users and they are forced to click on "OK" to continue. 
			For giggles, I would let white team decide the message and we would have fun with the message.</p>
			<p>There were two ways to access the virtual machines in the competition: VMware vSphere client on desktop and
			Web GUI (Firefox is less of a hassle).
			The feature does not exist on a web browser, and there are future plans for the next back-end guy to push acessibility
			primarily to the cloud. So enjoy it while you can!</p>
			<p>Some messages we used include:
				<ul>
					<li>5 minutes left lol</li>
					<li>Make like an autobot and ROLLOUT</li>
					<li>time to panic</li>
					<li>it's hiiiiiigh noon</li>
				</ul>
			</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp6_alertStudents.png" alt="comp6_alertStudents.png">
			</figure>
			
			<p class="subtopic">Killing Sessions & Suspending VMs</p>
			<p>Terminate session keys of all students, thereby kicking them off the virtual environment.
			My professor wanted to know if it could be done. I wanted to know if it could be done.
			Can I forcibly remove the student's connection to the server? Yes. And you can pull up other pieces of information with
			the session manager, such as username, key, full name, IP address, login time, and last active time.</p>
			<p>Suspend all red and blue team boxes that haven't reached Suspend state.
			There was a few moments when the student still has access to the virtual machine, so I needed to kick
			them out of my infrastructure to actually ensure the new permissions go into effect. 
			By grabbing their session key, I could terminate it.</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp7_terminateSessions.png" alt="comp7_terminateSessions.png">
			</figure>
			
			<p>Take snapshots of all virtual machines in the competition with predefined user input from the beginning.
			Finally, to suspend the machines without any issues. They are done sequentially so the script runs until the last
			query is done.</p>
			<figure>
				<img class="blogPic" src="../../assets/images/comp8_suspendingVMs.png" alt="comp8_suspendingVMs.png">
			</figure>
			
			</section>		
		<footer>
			<a href ="https://maps.google.com/?daddr=Rochester+Institute+of+Technology,+Rochester,+NY">
				<img src="../../assets/images/stock_location.png" alt="Currently at">
			</a>
			<a href="mailto:webb.felipe@gmail.com">
				<img src="../../assets/images/stock_email.png" alt="Email">
			</a>
			<a href="https://www.reddit.com/user/acomputerguy1/">
				<img src="../../assets/images/stock_reddit.png" alt="Reddit">
			</a>
			<a href="https://www.linkedin.com/in/felipe-webb">
				<img src="../../assets/images/stock_linkedin.png" alt="LinkedIn">
			</a>
			<a href="https://github.com/acomputerguy">
				<img src="../../assets/images/stock_github.png" alt="GitHub">
			</a>
		</footer>
	</body>
	
</html>